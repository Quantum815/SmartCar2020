/*********************************************************************************************************************
 * COPYRIGHT NOTICE
 * Copyright (c) 2019,逐飞科技
 * All rights reserved.
 * 技术讨论QQ群：一群：179029047(已满)  二群：244861897
 *
 * 以下所有内容版权均属逐飞科技所有，未经允许不得用于商业用途，
 * 欢迎各位使用并传播本程序，修改内容时必须保留逐飞科技的版权声明。
 *
 * @file       		main
 * @company	   		成都逐飞科技有限公司
 * @author     		逐飞科技(QQ3184284598)
 * @version    		查看doc内version文件 版本说明
 * @Software 		IAR 8.3 or MDK 5.28
 * @Target core		NXP RT1064DVL6A
 * @Taobao   		https://seekfree.taobao.com/
 * @date       		2019-04-30
 ********************************************************************************************************************/

#include "headfile.h"       //没插摄像头需要define为0 不然程序会卡住
float cut;



int main(void)
{
	uint8 cnt=0;
    DisableGlobalIRQ();
    board_init();
    UserInit();
    EnableGlobalIRQ(0);
	InitGYRORollAngle();
	//gpio_init(B9,GPO,0,GPIO_PIN_CONFIG);
    while (1)

    {
			cut=GetDistant();
			if(cut<=0.1)
	{
		GYROPID(0.025,0,0.098);
	}
	else if(cut>0.1&&cut<=0.5)
	{
		if(cnt==0)
		{
			_NowGyroYawAngle=90;
			cnt++;
		}
			GYROPID(0.035,0.1,0.095);
	}
	else if(cut>0.5)
	{
		MotorUserHandle(RMotor_F,0);
		MotorUserHandle(RMotor_F,0);
		//CleanDistant();
	}
			//GYROPID(0,0,0);
			//UpDateLaserDistant();
//		cut=GYROPID(0.35,0,2);
//			test1=LeftDeadZone+cut;
//			test2=RightDeadZone-cut;
//			if(test1>=40)
//				test1=40;
//			else if(test1<=-40)
//			test1=-40;
//			if(test2>=40)
//				test2=40;
//			else if(test2<=-40)
//				test2=-40;
//    MotorUserHandle(LMotor_F, test1);
//    MotorUserHandle(RMotor_F, test2);
//						MotorUserHandle(LMotor_F,20);
//			MotorUserHandle(RMotor_F,20);
			//MotorUserHandle(LMotor_F,LeftDeadZone);
			//MotorUserHandle(RMotor_F,RightDeadZone);
			//PRINTF("%f\r\n",GetLaserDistant());
			//test1=GYROPID(0,0,0,0);

//			test1=GetDistant();
//			test2=GetSpeed();
			//ips114_showuint8(140,20,DebugRx_Buffer);
			//PRINTF("%lf\r\n",GetSpeed());
			//systick_delay_ms(50);
//			ips114_showstr(20,0,"distant:");
//			ips114_showstr(20,20,"speed:");
			//ips114_showfloat(100,0,LPWM,4,4);
			//ips114_showfloat(70,20,RPWM,4,4);
			//pwm_init(PWM2_MODULE3_CHA_D2, 2000,25000);
			//UserDebug();
//			SetMotorPWM(LMotor_B,30);
//			SetMotorPWM(RMotor_B,50);
//			SetMotorPWM(LMotor_F,50);
//			SetMotorPWM(RMotor_F,30);
    }
}


//SetMotorPWM(LMotor_B,0);
//SetMotorPWM(RMotor_F,50);//向板子，左，向板子转
//SetMotorPWM(LMotor_B,50);//向板子，左，反向板子转
//SetMotorPWM(RMotor_B,50);//向板子，右，反向板子转
//SetMotorPWM(LMotor_F,50);//向板子，右，向板子转
//systick_delay_ms(1000);
//SetMotorPWM(RMotor_F,0);
//SetMotorPWM(RMotor_F,50);//向板子，左，向板子转
//SetMotorPWM(LMotor_B,50);//向板子，左，反向板子转
//SetMotorPWM(RMotor_B,50);//向板子，右，反向板子转
//SetMotorPWM(LMotor_F,50);//向板子，右，向板子转
//左右已经修正
//			test1=IsrCount;
//			CameraProcess();
//			test2=IsrCount;
//			cut=test2-test1;
//		if(mt9v03x_csi_finish_flag)
//	{
//		mt9v03x_csi_finish_flag=0;
//    //ips114_displayimage032_zoom(mt9v03x_csi_image[0], MT9V03X_CSI_W, MT9V03X_CSI_H, 240, 135);
//		seekfree_sendimg_03x_usb_cdc(mt9v03x_csi_image[0], MT9V03X_CSI_W, MT9V03X_CSI_H);
//	}
//			//gpio_toggle(D15);
//			//systick_delay_ms(1000);
//			//SetMotorPWM(LMotor_F,0);
//			//SetMotorPWM(RMotor_B,0);
//			SetMotorPWM(RMotor_F,50);//向板子，左，向板子转
//			SetMotorPWM(LMotor_B,50);//向板子，左，反向板子转
////			//SetMotorPWM(RMotor_B,50);//向板子，右，反向板子转
////			//SetMotorPWM(LMotor_F,50);//向板子，右，向板子转
//			//systick_delay_ms(1000);
//			//SetMotorPWM(LMotor_B,0);
//			//SetMotorPWM(RMotor_F,0);
//			SetMotorPWM(RMotor_B,50);//向板子，左，向板子转
//////			
//			SetMotorPWM(LMotor_F,50);//向板子，左，反向板子转
//////SetMotorPWM(RMotor_B,50);//向板子，右，反向板子转
//////SetMotorPWM(LMotor_F,50);//向板子，右，向板子转
//////左右已经修正
////        //UserDebug();
////			SetServoPWM(1,50);
////			SetServoPWM(2,50);
////			SetServoPWM(3,50);
